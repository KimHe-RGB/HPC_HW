# Report

## Processor I am Using

Intel(R) Core(TM) i9-9880H CPU @ 2.30GHz

## Q1: `MMult1()` with rearanged loop

### Same Order as `MMult0()` `(i, j, p)`

| Dimension  |   Time  |  Gflop/s |  GB/s  |  error  |
| :---       |   ---:  |   ---:   |   ---: |   ---:  |
|   16 | 0.685992 | 2.915492 |13.848587 | 0.000000e+00 |
|   64 | 0.969992 | 2.062037 | 8.634780 | 0.000000e+00 |
|  112 | 0.919079 | 2.176764 | 8.940279 | 0.000000e+00 |
|  160 | 0.942909 | 2.128561 | 8.673885 | 0.000000e+00 |
|  208 | 0.922164 | 2.185898 | 8.869700 | 0.000000e+00 |
|  256 | 1.780434 | 1.130773 | 4.576096 | 0.000000e+00 |
| ... | ... |  ... | ... | ... |
| 1024 | 2.679834 | 0.801350 | 3.214789 | 0.000000e+00 |
| 1072 | 1.250729 | 1.969932 | 7.901779 | 0.000000e+00 |
| 1120 | 2.051045 | 1.369963 | 5.494530 | 0.000000e+00 |
| 1168 | 1.606318 | 1.983933 | 7.956113 | 0.000000e+00 |
| 1216 | 2.704064 | 1.329884 | 5.332660 | 0.000000e+00 |
| 1264 | 2.254680 | 1.791374 | 7.182504 | 0.000000e+00 |
| 1312 | 3.236392 | 1.395630 | 5.595285 | 0.000000e+00 |
| 1360 | 2.795274 | 1.799792 | 7.215050 | 0.000000e+00 |
| 1408 | 5.887093 | 0.948281 | 3.801206 | 0.000000e+00 |
| 1456 | 4.327009 | 1.426679 | 5.718475 | 0.000000e+00 |
| 1504 | 7.104705 | 0.957696 | 3.838423 | 0.000000e+00 |
| 1552 | 7.552599 | 0.989940 | 3.967413 | 0.000000e+00 |
| 1600 |10.373070 | 0.789737 | 3.164872 | 0.000000e+00 |
| 1648 |12.089778 | 0.740429 | 2.967106 | 0.000000e+00 |
| 1696 |14.598687 | 0.668334 | 2.678066 | 0.000000e+00 |
| 1744 |18.199066 | 0.582935 | 2.335752 | 0.000000e+00 |
| 1792 |20.643607 | 0.557517 | 2.233803 | 0.000000e+00 |

### Best Order `(j, p, i)`

| Dimension  |   Time  |  Gflop/s |  GB/s  |  error  |
| :---       |   ---:  |   ---:   |   ---: |   ---:  |
|   16 | 0.257017 |  7.781598 | 36.962591 | 0.000000e+00 |
|   64 | 0.127835 | 15.646361 | 65.519137 | 0.000000e+00 |
|  112 | 0.119414 | 16.753565 | 68.809284 | 0.000000e+00 |
|  160 | 0.121765 | 16.482907 | 67.167845 | 0.000000e+00 |
|  208 | 0.149558 | 13.478103 | 54.689995 | 0.000000e+00 |
|  256 | 0.154210 | 13.055347 | 52.833356 | 0.000000e+00 |
|  304 | 0.168571 | 11.999670 | 48.472351 | 0.000000e+00 |
|  352 | 0.157138 | 12.767501 | 51.505259 | 0.000000e+00 |
|  400 | 0.165744 | 12.356394 | 49.796269 | 0.000000e+00 |
|  448 | 0.163512 | 13.197583 | 53.143839 | 0.000000e+00 |
|  496 | 0.163540 | 13.430513 | 54.046984 | 0.000000e+00 |
|  544 | 0.167306 | 13.471404 | 54.182779 | 0.000000e+00 |
|  592 | 0.170555 | 12.164651 | 48.905184 | 0.000000e+00 |
|  640 | 0.172932 | 12.127008 | 48.735412 | 0.000000e+00 |
|  688 | 0.219593 | 11.864140 | 47.663491 | 0.000000e+00 |
|  736 | 0.183715 | 13.020871 | 52.295780 | 0.000000e+00 |
|  784 | 0.218515 | 13.231782 | 53.129655 | 0.000000e+00 |
|  832 | 0.172635 | 13.344481 | 53.570392 | 0.000000e+00 |
|  880 | 0.223363 | 12.203858 | 48.981847 | 0.000000e+00 |
|  928 | 0.268523 | 11.904814 | 47.773197 | 0.000000e+00 |
|  976 | 0.334864 | 11.105566 | 44.558809 | 0.000000e+00 |
| 1024 | 0.168564 | 12.739868 | 51.108766 | 0.000000e+00 |
| 1072 | 0.218461 | 11.278207 | 45.239075 | 0.000000e+00 |
| 1120 | 0.268600 | 10.461118 | 41.956554 | 0.000000e+00 |
| 1168 | 0.322604 |  9.878441 | 39.615257 | 0.000000e+00 |
| 1216 | 0.419667 |  8.568922 | 34.360248 | 0.000000e+00 |
| 1264 | 0.526529 |  7.670945 | 30.756606 | 0.000000e+00 |
| 1312 | 0.600801 |  7.517974 | 30.140658 | 0.000000e+00 |
| 1360 | 0.721166 |  6.976078 | 27.965866 | 0.000000e+00 |
| 1408 | 0.851514 |  6.556108 | 26.280309 | 0.000000e+00 |
| 1456 | 1.032211 |  5.980613 | 23.971744 | 0.000000e+00 |
| 1504 | 1.193672 |  5.700178 | 22.846193 | 0.000000e+00 |
| 1552 | 1.339788 |  5.580446 | 22.364932 | 0.000000e+00 |
| 1600 | 1.478549 |  5.540566 | 22.203820 | 0.000000e+00 |
| 1648 | 1.628804 |  5.495823 | 22.023310 | 0.000000e+00 |
| 1696 | 1.821594 |  5.356190 | 21.462657 | 0.000000e+00 |
| 1744 | 1.978263 |  5.362722 | 21.487789 | 0.000000e+00 |
| 1792 | 2.211963 |  5.203148 | 20.847435 | 0.000000e+00 |
| 1840 | 2.418454 |  5.151641 | 20.640160 | 0.000000e+00 |
| 1888 | 2.620430 |  5.136454 | 20.578465 | 0.000000e+00 |
| 1936 | 3.105012 |  4.673936 | 18.724716 | 0.000000e+00 |
| 1984 | 3.302015 |  4.730161 | 18.949253 | 0.000000e+00 |

## Q2

  Implement a one level blocking scheme by using BLOCK_SIZE macro as the block size.

  Experiment with different values for BLOCK_SIZE (use multiples of 4) and measure performance.  What is the optimal value for BLOCK_SIZE?

### Q2 Answer

The optimal value for block_size is `64`. This is consistent with the size of the L1 cache (32KB):

```text
64 * 64 * 8 (double size) / 1024 = 32 (KB)
```

Comparing to the naive version, the one level blocked computation does not degenerate as the dimension grows.

The bandwidth is lower because much less read/writes are required.

The GFlops/s is larger for big matrix dimension, as well as the overall time, implying that we are doing better than the naive version.

### Block size = 16

| Dimension  |   Time  |  Gflop/s |  GB/s  |  error  |
| :---       |   ---:  |   ---:   |   ---: |   ---:  |
|   16 | 0.281213 | 7.112058 | 5.334044 | 0.000000e+00 |
|   64 | 0.273203 | 7.321143 | 2.745429 | 0.000000e+00 |
|  112 | 0.283452 | 7.058043 | 2.268657 | 0.000000e+00 |
|  160 | 0.282456 | 7.105679 | 2.131704 | 0.000000e+00 |
|  208 | 0.286037 | 7.047183 | 2.032841 | 0.000000e+00 |
|  256 | 0.306566 | 6.567146 | 1.847010 | 0.000000e+00 |
| ... | ... |  ... | ... | ... |
| 1792 | 1.738260 | 6.621085 | 1.684830 | 0.000000e+00 |
| 1840 | 1.760845 | 7.075584 | 1.799659 | 0.000000e+00 |
| 1888 | 1.904435 | 7.067563 | 1.796838 | 0.000000e+00 |
| 1936 | 2.016655 | 7.196388 | 1.828834 | 0.000000e+00 |
| 1984 | 2.526510 | 6.182071 | 1.570446 | 0.000000e+00 |

### Block size = 32

| Dimension  |   Time  |  Gflop/s |  GB/s  |  error  |
| :---       |   ---:  |   ---:   |   ---: |   ---:  |
|  32 | 0.177685 | 11.255998 | 4.220999 | 0.000000e+00 |
|  64 | 0.176189 | 11.352367 | 2.838092 | 0.000000e+00 |
|  96 | 0.176659 | 11.328451 | 2.360094 | 0.000000e+00 |
| 128 | 0.185500 | 10.785338 | 2.022251 | 0.000000e+00 |
| 160 | 0.175925 | 11.408511 | 1.996489 | 0.000000e+00 |
| 192 | 0.181197 | 11.093556 | 1.848926 | 0.000000e+00 |
| 224 | 0.179143 | 11.167728 | 1.794813 | 0.000000e+00 |
| 256 | 0.209724 |  9.599613 | 1.499939 | 0.000000e+00 |
| ... | ... |  ... | ... | ... |
|1792 | 1.231112 |  9.348595 | 1.210309 | 0.000000e+00 |
|1824 | 1.392174 |  8.717881 | 1.127971 | 0.000000e+00 |
|1856 | 1.500721 |  8.520479 | 1.101786 | 0.000000e+00 |
|1888 | 1.552648 |  8.668882 | 1.120343 | 0.000000e+00 |
|1920 | 1.368810 | 10.341664 | 1.335798 | 0.000000e+00 |
|1952 | 1.751788 |  8.491567 | 1.096247 | 0.000000e+00 |
|1984 | 1.790564 |  8.722984 | 1.125546 | 0.000000e+00 |

### Block size = 64

| Dimension  |   Time  |  Gflop/s |  GB/s  |  error  |
| :---       |   ---:  |   ---:   |   ---: |   ---:  |
|   64 | 0.145292 | 13.766449 | 2.581209 | 0.000000e+00 |
|  128 | 0.170384 | 11.742215 | 1.467777 | 0.000000e+00 |
|  192 | 0.153745 | 13.074338 | 1.361910 | 0.000000e+00 |
|  256 | 0.156732 | 12.845246 | 1.204242 | 0.000000e+00 |
| ... | ... |  ... | ... | ... |
| 1728 | 0.841431 | 12.264305 | 0.823298 | 0.000000e+00 |
| 1792 | 1.024244 | 11.236750 | 0.752461 | 0.000000e+00 |
| 1856 | 0.991407 | 12.897694 | 0.861699 | 0.000000e+00 |
| 1920 | 1.158926 | 12.214562 | 0.814304 | 0.000000e+00 |
| 1984 | 1.199010 | 13.026638 | 0.866692 | 0.000000e+00 |

### Block size = 128

| Dimension  |   Time  |  Gflop/s |  GB/s  |  error  |
| :---       |   ---:  |   ---:   |   ---: |   ---:  |
|  128 | 0.127358 | 15.709126 | 1.472731 | 0.000000e+00 |
|  256 | 0.160032 | 12.580410 | 0.786276 | 0.000000e+00 |
|  384 | 0.149709 | 13.615991 | 0.709166 | 0.000000e+00 |
|  512 | 0.271048 |  7.922880 | 0.371385 | 0.000000e+00 |
|  640 | 0.149215 | 14.054540 | 0.614886 | 0.000000e+00 |
|  768 | 0.272961 |  9.957141 | 0.414881 | 0.000000e+00 |
|  896 | 0.237018 | 12.139537 | 0.487749 | 0.000000e+00 |
| 1024 | 0.302243 |  7.105154 | 0.277545 | 0.000000e+00 |
| 1152 | 0.242140 | 12.627582 | 0.482303 | 0.000000e+00 |
| 1280 | 0.337985 | 12.409740 | 0.465365 | 0.000000e+00 |
| 1408 | 0.460713 | 12.117346 | 0.447516 | 0.000000e+00 |
| 1536 | 0.978405 |  7.407731 | 0.270074 | 0.000000e+00 |
| 1664 | 0.750957 | 12.270862 | 0.442459 | 0.000000e+00 |
| 1792 | 1.265795 |  9.092441 | 0.324730 | 0.000000e+00 |
| 1920 | 1.341519 | 10.552050 | 0.373718 | 0.000000e+00 |

## Q3

  What percentage of the peak FLOP-rate do you achieve with your code?

### Q3 Answer

According to Intel product page, the peak FLOP-rate of my CPU (i9-9880H CPU @ 2.30GHz) is 294.4 GFLOPS

The one level blocking scheme code achieved 13 Gflops/s for dimension = 1984, when the grid_size = 64.

So we achieved only about `4.4%` of the peak FLOP-rate.
